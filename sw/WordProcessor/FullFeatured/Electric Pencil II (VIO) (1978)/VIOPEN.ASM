;
; ELECTRIC PENCIL SOURCE CODE
; VERSION DI-II FOR IMSAI VIO
;
	BASE	EQU	0
	BDOS	EQU	BASE+5
	FCB	EQU	BASE+5CH
	BUFF	EQU	BASE+80H
	TPA	EQU	BASE+100H
;
VIO	EQU	0F000H
NCOLS	EQU	80
NROWS	EQU	24
;
	ORG	TPA
;
	JMP	INITPEN
;
	DB	'THE ELECTRIC PENCIL II (C) 1978 '
	DB	'MICHAEL SHRAYER VER. DI-II REV. 3 '
;
INITPEN:LXI	SP,SCRLSPD
	MVI	A,8		;INITIALIZE VIO
	STA	VIO+7FFH
	LDA	BASE+2		;BIOS PAGE ADDRESS
	STA	CONST1+2	;SELF MODIFY CODE TO DO BIOS CALLS
	STA	CONIN1+2
	STA	LIST1+2
	MVI	A,1		;USE DRIVE A:
	STA	5CH
;
; CLEAR TEXT BUFFER AND RE-INITIALIZE SYSTEM
;
COLDST:	LXI	H,SCRLSPD
	CALL	L1380		;ZERO MEMORY FROM SCRLSPD TO BASE OF CP/M
	DCX	H
	DCR	H
	SHLD	MEMTOP		;TEXT BUFFER UPPER LIMIT
	CALL	L0F2C		;RESTORE DEFAULT PRINT VALUES
	LXI	H,TXTBUF-1
	MVI	M,0DH
	INX	H
	SHLD	BUFEND
	LXI	D,SOM		;SIGN ON MESSAGE
	LXI	H,VIO+37EH
	CALL	L0801		;CLEAR SCREEN & PRINT MESSAGE
L017E:	CALL	CONST
	ORA	A
	JZ	L017E
	JMP	WARMST
;
; CONSOLE STATUS CALL
;
CONST:	PUSH	B
	PUSH	D
	PUSH	H
CONST1:	CALL	6
	POP	H
	POP	D
	POP	B
	RET
;
; CONSOLE INPUT CALL
;
CONIN:	PUSH	B
	PUSH	D
	PUSH	H
CONIN1:	CALL	9
	POP	H
	POP	D
	POP	B
	RET
;
; LIST DEVICE OUTPUT
;
LIST:	PUSH	PSW
	PUSH	B
	PUSH	D
	PUSH	H
	MOV	C,A
LIST1:	CALL	0FH
	POP	H
	POP	D
	POP	B
	POP	PSW
	RET
;
WARMST:	MVI	A,8		;INITIALIZE VIO
	STA	VIO+7FFH
	LXI	H,0
	SHLD	COLUMN		;ZERO ROW AND COLUMN
	LXI	H,TXTBUF		
L01B7:	CALL	L0684		;PUT 1ST PAGE ON SCREEN
L01BA:	LXI	SP,SCRLSPD
	LXI	H,L01BA		;RETURN ADDR FROM MAIN PROCESSING LOOP
	PUSH	H		;SIMULATE A CALL
	LXI	H,0
	SHLD	RPTCMD
	SHLD	RPTCNT
	LHLD	BUFEND
	XRA	A
	MOV	M,A
	STA	L1892
	STA	L1885
	STA	L18AD
	STA	L188E
	STA	L188B
	CALL	L02C5		;RET ADDR OF CURSOR IN H,L
	MOV	A,M
	PUSH	PSW
	LDA	INSFLG		;INSERT MODE FLAG
	ORA	A
	MOV	A,M
	JZ	L01ED
	MVI	A,9		;USE HOR. TAB AS CURSOR CHAR IN INSERT MODE
L01ED:	ORI	80H		;TURN CURSOR ON
	MOV	M,A
	CALL	L125F
	MOV	C,A
	POP	PSW
	MOV	M,A
	MOV	A,C
L01F7:	CPI	7FH
	JZ	L036C		;DESTRUCTIVE BACKSPACE
	CPI	20H
	JNC	L0458		;PRINTABLE CHAR
	CPI	0AH
	JZ	L03C5		;LINE FEED
	CPI	0CH
	JZ	L03C0		;FORM FEED
	CPI	0DH
	JZ	L03CD		;CARRIAGE RETURN (CURSOR)
	CPI	'T'-40H
	JZ	L088E		;ERASE TO END OF LINE
	CPI	'Y'-40H
	JZ	L0657		;DELETE LINE
	CPI	'D'-40H
	JZ	L03EC		;DELETE CHAR
	CPI	'F'-40H
	JZ	L0450		;INSERT CHAR MODE
	CPI	'A'-40H
	JZ	L036E		;CURSOR LEFT
	CPI	'S'-40H
	JZ	L04D1		;CURSOR RIGHT
	CPI	'I'-40H
	JZ	L03D2		;HORIZONTAL TAB (CURSOR)
	CPI	'P'-40H
	JZ	L13C9		;PRINT SUB-SYSTEM
	PUSH	PSW
	CALL	L065D
	CALL	L02C5
	POP	PSW
	CPI	'W'-40H
	JZ	L037B		;CURSOR UP
	CPI	'Z'-40H
	JZ	L034E		;CURSOR DOWN
	CPI	'R'-40H
	JZ	L04DB		;REPEAT FUNCTION
	MOV	C,A
	XRA	A
	STA	INSFLG
	MOV	A,C
	CPI	'K'-40H
	JZ	L0A0C		;I/O SCOREBOARD
	CPI	'E'-40H
	JZ	L0305		;SCROLL UP
	CPI	'X'-40H
	JZ	L031A		;SCROLL DOWN
	CPI	'V'-40H
	JZ	L08B9		;STRING SEARCH
	CPI	'C'-40H
	JZ	L09DB		;CONTINUE SEARCH
	CPI	'G'-40H
	JZ	L0403		;INSERT LINE
	CPI	'Q'-40H
	JZ	L02E8		;HOME CURSOR
	CPI	'U'-40H
	JZ	L05C7		;DELETE BLOCK
	CPI	'H'-40H
	JZ	L05DD		;INSERT BLOCK
	CPI	'B'-40H
	JZ	WARMST		;CURSOR TO BEG. OF FILE
	CPI	'N'-40H
	JZ	L02F9		;CURSOR TO END OF FILE
	CPI	'O'-40H
	RNZ
	LXI	D,L02B4		;EXIT SYSTEM
	LXI	H,VIO+38EH
	CALL	L0801
	CALL	L125F
	CPI	'Y'
	JNZ	L0A0C
	CALL	CLRVIO
	JZ	BASE		;EXIT (THIS JUMP ALWAYS TAKEN)
;
	DB	0DAH,0F8H,02H,03EH
;
; THIS CODE MODIFIES PRINT ROUTINE TO PRINT ENCRYPTED MESSAGES
;
L02AA:	CMA
	PUSH	H
	MOV	H,A
	MVI	L,1AH		;LDAX D INSTRUCTION
L02AF:	SHLD	L13C0
	POP	H
	RZ
;
; ENCRYPTED LITERALS
;
L02B4:	IRPC	R,<ALL TEXT SECURE?>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
; CALCULATE THE ADDRESS REPRESENTED BY THE ROW IN ROW
; AND THE COLUMN IN ROW.
;
L02C5:	LDA	COLUMN		;COLUMN
	MOV	B,A
L02C9:	LDA	ROW		;ROW
	PUSH	D
	LXI	D,NCOLS
	LXI	H,VIO
L02D3:	DAD	D
	DCR	A
	JP	L02D3
	SHLD	L18A7	
	LXI	D,-NCOLS
	DAD	D
	SHLD	L189D
	INR	D
	MOV	E,B
	DAD	D
	POP	D
	RET
;
	DB	21H
;
; HOME CURSOR
;
L02E8:	XRA	A
	STA	COLUMN		;ZERO OUT COL
L02EC:	STA	ROW		;ZERO OUT ROW
L02EF:	CALL	L042B
	MOV	A,C
	STA	L1887
	INR	A
	RET
;
	DB	2AH
;
; CURSOR TO END OF FILE
;
L02F9:	LXI	H,0		;ZERO OUT ROW AND COLUMN
	SHLD	COLUMN
	LHLD	BUFEND		;END OF FILE POINTER ?
	JMP	L01B7
;
; SCROLL UP
;
L0305:	LHLD	L1899
	MOV	A,M
	ORA	A
	RZ
	CALL	L0360
	RZ
L030F:	CALL	L032C
	LDA	L188E
	CPI	'X'-40H
	JNZ	L0305
;
; SCROLL DOWN
;
L031A:	CALL	L0386
	RZ
	CALL	L032C
	LDA	L188E
	CPI	'E'-40H
	JNZ	L031A
	JMP	L0305
;
L032C:	CALL	L1229
	LDA	L1888
	ORA	A
	JZ	L121C
	STA	L18AD
	LDA	L188B
	INR	A
	CPI	NROWS
	STA	L188B
	RNZ
	XRA	A
	STA	L188B
	CALL	L123A
	STA	L18AD
	RET
;
; CURSOR DOWN
;
L034E:	LDA	L1887
	DCR	A
	RM
L0353:	XRA	A
	STA	INSFLG
	LDA	ROW
	INR	A
	CPI	NROWS
	JNZ	L02EC
L0360:	LHLD	L1897
	CALL	L06D6
	ORA	A
	RZ
	INX	H
	JMP	L0684
;
; DELETE - DESTRUCTIVE BACKSPACE
;
L036C:	MVI	M,20H
;
; CURSOR LEFT - NON DESTRUCTIVE BACKSPACE
;
L036E:	MOV	A,B
	DCR	A
	JP	L03CE
	MVI	A,NCOLS-1
	STA	COLUMN
	CALL	L065D
;
; CURSOR UP
;
L037B:	XRA	A
	STA	INSFLG
	LDA	ROW
	DCR	A
	JP	L02EC
L0386:	LHLD	L1897
	LXI	D,TXTBUF
	MOV	A,E
	SUB	L
	MOV	A,D
	SBB	H
	JNZ	L0396
	MOV	A,E
	SUB	L
	RZ
L0396:	CALL	L03A0
	LHLD	L1895
	JMP	L0684
;
L039F:	DB	21H
;
L03A0:	MOV	D,H
	MOV	E,L
	DCX	H
L03A3:	DCX	H
	MOV	A,M
	CPI	0EH		;COULD BE CNTRL-N
	JNC	L03A3
	INX	H
L03AB:	SHLD	L1895
	CALL	L06D6
	INX	H
	MOV	A,E
	SUB	L
	MOV	A,D
	SBB	H
	RC
	JNZ	L03AB
	MOV	A,E
	SUB	L
	JNZ	L03AB
	RET
;
; FORM FEED
;
L03C0:	MVI	M,'L'-40H		;CNTL-L
	JMP	L03C7
;
; LINE FEED
;
L03C5:	MVI	M,0DH
L03C7:	CALL	L065D
	CALL	L034E
L03CD:	XRA	A
L03CE:	STA	COLUMN
	RET
;
; TAB - MOVE CURSOR 8 CHARS TO RIGHT
;
L03D2:	MOV	A,B
	ADI	8
	ANI	0F8H		;FORCE MULTIPLE OF 8
	STA	COLUMN
	CPI	NCOLS
	RC
	XRA	A
	STA	COLUMN
	CALL	L042B
	RZ
	CALL	L065D
	JMP	L034E
;
	DB	31H
;
; DELETE CHAR AND CLOSE UP LINE
;
L03EC:	INX	H
L03ED:	MOV	A,M
	DCX	H
	MOV	M,A
	INX	H
	INX	H
	LDA	L18A7
	CMP	L
	JNZ	L03ED
	DCX	H
	MVI	M,20H
	JZ	L065D
	JM	L039F
;
	DB	22H
;
; INSERT LINE ROUTINE
;
L0403:	MVI	B,0
	CALL	L02C9
L0408:	PUSH	H
	MOV	B,M
	MVI	C,1
	MOV	M,C
	LXI	D,VIO+72FH
	CALL	L0446
	JNC	L041C
	LXI	H,VIO+77FH
	CALL	L05BC
L041C:	POP	H
	CALL	L088E
	STA	L1887
	JZ	L03CE		;ALWAYS TAKE THIS JUMP
;
	DB	0CDH,40H,04H,0C3H,0ACH
;
L042B:	LXI	B,NCOLS
	CALL	L02C9
	DAD	B
L0432:	DCX	H
	MOV	A,M
	ANI	7FH
	CPI	20H
	JNZ	L0441
	DCR	C
	JNZ	L0432
	RET
;
	DB	11H
;
L0441:	CPI	0EH
	RC
	INR	C
	RET
;
L0446:	MOV	A,L
	SUB	E
	MOV	A,H
	SBB	D
	RC
	RNZ
	MOV	A,L
	SUB	E
	ORA	A
	RET
;
; TURN INSERT ON-OFF
;
L0450:	LDA	INSFLG
	CMA
	STA	INSFLG
	RET
;
; ENTRY POINT FOR TYPING OF NORMAL CHARS
;
L0458:	CPI	5CH		;DELIMITER CHAR
	JZ	L0464
	LDA	INSFLG
	ORA	A
	JZ	L0486
L0464:	MOV	A,B
	CPI	NCOLS-1
	JZ	L085B
	PUSH	B
	PUSH	H
	CPI	NCOLS-14	;32H IN VDM VERSION, 42H IN VIO VERSION
	JC	L0473
	MVI	C,20H
L0473:	MOV	B,M
	MOV	M,C
	MOV	C,B
	INX	H
	LDA	L18A7
	CMP	L
	JNZ	L0473
	CALL	L06D1
	CALL	L065D
	POP	H
	POP	B
L0486:	MOV	M,C
	MOV	A,B
	INR	A
	CPI	NCOLS-1
	JC	L03CE
	JNZ	L085B
	MOV	A,C
	CPI	20H
	JNZ	L04A7
	CALL	L042B
	JZ	L03CD
	CALL	L065D
	CALL	L0353
	JMP	L0403
;
	DB	0EH
;
L04A7:	CALL	L06D1
	MVI	A,NCOLS-1
	SUB	C
	MOV	B,A
	PUSH	PSW
	PUSH	B
	CALL	L065D
	CALL	L0353
	POP	B
	CALL	L02C9
	PUSH	H
	CALL	L0408
	POP	H
	MVI	M,0DH
	POP	PSW
	STA	COLUMN
	INR	A
	STA	L1887
	PUSH	H
	CALL	L065D
	POP	H
	MVI	M,20H
	RET
;
; CURSOR RIGHT
;
L04D1:	MOV	A,B
	INR	A
	CPI	NCOLS
	JZ	L03C7
	JMP	L03CE
;
; REPEAT COMMAND
;
L04DB:	LDA	RPTCMD
	ORA	A
	RNZ
	LXI	H,0
L04E3:	CALL	L125F		;GET CHAR
	CALL	L050F		;ADD CHAR TO VALUE IN H,L RET CARRY NOT NUMERIC
	JC	L04E3		;NUMERIC, GET 2ND OR 3RD CHR
	STA	RPTCMD		;SAVE CHAR TYPED (COMMAND TO REPEAT)
L04EF:	MOV	A,L		;SEE IF REPEAT COUNT = ZERO
	ORA	H
	RZ
	DCX	H
	SHLD	RPTCNT		;SAVE REPEAT COUNT
	CALL	L02C5		;CALC SCREEN ADDR
	LDA	RPTCMD		;GET COMMAND
	MOV	C,A		;IN C
	CALL	L01F7		;DISPATCH TO COMMAND
	CALL	L1229
	LHLD	BUFEND
	MVI	M,0
	LHLD	RPTCNT
	JMP	L04EF
;
	DB	11H
;
; ACCUMULATE 16 BIT VALUE IN H,L, RET CARRY CLEAR IF
; CHAR IN ACC IS NOT NUMERIC
;
L050F:	CPI	'0'
	CMC
	RNC
	CPI	'9'+1
	RNC
	MOV	B,H
	MOV	C,L
	DAD	H
	DAD	H
	DAD	B
	DAD	H
	SUI	'0'
	MOV	C,A
L051F:	MVI	B,0
	DAD	B
	STC
	RET
;
L0524:	CALL	L056B
	MOV	D,H
	MOV	E,L
	LDA	COLUMN
	MOV	C,A
	MVI	B,0
	DAD	B
	XCHG
	CALL	L06D6
	CALL	L0446
	RC
	XCHG
	RET
;
SOM:	IRPC	R,<THE ELECTRIC PENCIL II  (C) 1978 MICHAEL SHRAYER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L056B:	LHLD	L1897
	LDA	ROW
	ORA	A
	RZ
	MOV	B,A
L0574:	CALL	L06D6
	ORA	A
	RZ
	INX	H
	DCR	B
	JNZ	L0574
	RET
;
L057F:	SUB	B
	RZ
	JNC	L05A4
	LHLD	L18C4
	MOV	D,H
	MOV	E,L
	MOV	A,B
	ADD	E
	MOV	E,A
	JNC	L0590
	INR	D
L0590:	MVI	B,0
	DAD	B
L0593:	LDAX	D
	MOV	M,A
	INX	D
	INX	H
	ORA	A
	JNZ	L0593
	DCX	H
	SHLD	BUFEND
	RZ			;THIS RETURN ALWAYS TAKEN
;
	DB	0CDH,0A6H,04H,21H
;
L05A4:	LHLD	BUFEND
	MOV	C,A
	MVI	B,0
L05AA:	DAD	B
	CALL	L138C
	LHLD	L18C4
	MOV	B,M
	MVI	C,1
	MOV	M,C
	LHLD	BUFEND
	XCHG
	SHLD	BUFEND
L05BC:	LDAX	D
	MOV	M,A
	DCX	D
	DCX	H
	CMP	C
	JNZ	L05BC
	INX	H
	MOV	M,B
	RET
;
; DELETE BLOCK COMMAND
;
L05C7:	CALL	L062B
	INX	D
	CALL	L0593
	CALL	L1380
	CALL	L0681
	LDA	L1887
	ORA	A
	JZ	L02E8
	RET
;
	DB	03EH
;
; INSERT BLOCK
;
L05DD:	CALL	L062B
	PUSH	H
	PUSH	D
	PUSH	H
	CALL	L0524
	POP	D
	CALL	L0446
	POP	D
	JZ	L0650
	JC	L05FB
	CALL	L0446
	JZ	L0650
	JC	L0650
	XRA	A
L05FB:	STA	L1889
	SHLD	L18C4
	POP	H
	INX	H
	MOV	A,E
	SUB	L
	MOV	C,A
	MOV	A,D
	SBB	H
	MOV	B,A
	LDA	L1889
	ORA	A
	JZ	L0611
	DAD	B
L0611:	PUSH	B
	PUSH	H
	LHLD	BUFEND
	CALL	L05AA
	POP	H
	POP	B
	INX	D
L061C:	MOV	A,M
	STAX	D
	INX	D
	INX	H
	DCX	B
	MOV	A,B
	ORA	C
	JNZ	L061C
	JMP	L0681
;
	DB	2AH,0FH
;
L062B:	LXI	H,TXTBUF
	CALL	L0646
	JZ	L0650
	PUSH	H
	CALL	L0645
	JZ	L0650
	MOV	D,H
	MOV	E,L
	CALL	L0645
	JNZ	L0650
	POP	H
	RET
;
L0645:	INX	H
L0646:	MOV	A,M
	ORA	A
	RZ
	CPI	5CH		;DELIMITER CHAR.
	JNZ	L0645
	ORA	A
	RET
;
L0650:	LXI	D,L080C
	JMP	L1397
;
	DB	06H
;
L0657:	LHLD	L189D
	CALL	L088E
L065D:	CALL	L056B
	SHLD	L18C4
	CALL	L042B
	LDA	L1887
	MOV	B,A
	MOV	A,C
	STA	L1887
	CALL	L057F
	LHLD	L18C4
	XCHG
	MVI	B,0
	CALL	L02C9
	LDA	L1887
	ORA	A
	CNZ	L11CD
L0681:	LHLD	L1897
L0684:	LXI	D,VIO
	SHLD	L1897
	MVI	B,NCOLS		;PROBABLY NCOLS
L068C:	MVI	C,1
	MOV	A,M
	ORA	A
	JZ	L069C
	PUSH	H
	CALL	L06AF
	POP	H
	ORA	A
	JNZ	L069D
L069C:	DCR	C
L069D:	XCHG
	CALL	L0879
	CALL	L06C9
	XCHG
	JNZ	L068C
	SHLD	L1899
	JMP	L02EF
;
L06AE:	MOV	A,M
L06AF:	CPI	0EH
	RC
	INR	C
	INX	H
	MOV	A,B
	CMP	C
	JNZ	L06AE
	MVI	A,20H
L06BB:	DCR	C
	DCX	H
	CMP	M
	JNZ	L06BB
L06C1:	DCR	C
	DCX	H
	CMP	M
	JZ	L06C1
	INR	C
	RET
;
L06C9:	MVI	A,(VIO+(NCOLS*NROWS)) AND 0FFH
	CMP	L
	RNZ
	MVI	A,((VIO+(NCOLS*NROWS)) SHR 8) AND 0FFH
	CMP	H
	RET
;
L06D1:	MVI	B,0
	CALL	L02C9
L06D6:	MVI	C,0
L06D8:	MOV	A,M
	ORA	A
	RZ
	INR	C
	MVI	A,50H
	CMP	C
	JZ	L07AB
	MOV	A,M
	ANI	7FH
	CPI	0CH
	RZ
	CPI	0DH
	RZ
	INX	H
	JMP	L06D8
;
	DB	0CDH,029H,06H,11H
;
L06F3:	IRPC	R,<WORD NUMBER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<DISK DRCTRY  D>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<RCRD NUMBER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<SAVE DSKFIL  S>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<LOAD DSKFIL  L>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<KILL DSKFIL  K>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<TAPE READER  R>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<TAPE VERIFY  V>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<TAPE WRITER  W>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<CLER AA CUR  CAA>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<CLER AB CUR  CAB>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<CLER SYSTEM  CLR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C2H,0EFH,06H,0CDH
;
L07AB:	DCX	H
	DCR	C
	JZ	L085B
	MOV	A,M
	ANI	7FH
	CPI	20H
	JNZ	L07AB
L07B8:	DCR	C
	JZ	L085B
	DCX	H
	MOV	A,M
	ANI	7FH
	CPI	20H
	JZ	L07B8
	INX	H
	INR	C
	RNZ
;
	DB	0CDH,0F8H,02H,21H,0FH
;
L07CD:	MOV	B,A
	LDA	LINLEN
	SUB	B
	MOV	B,A
	MVI	C,0
	LDA	L1886
	CPI	5FH
	JNZ	L07E7
	XRA	A
	STA	L1886
	JZ	L0819
;
	DB	0CDH,40H,04H
;
L07E7:	MOV	A,M
	CALL	L0871
	JNZ	L07F7
	CALL	L171E
	INX	D
	INX	H
	JMP	L07E7
;
L07F6:	MOV	A,M
L07F7:	CPI	20H
	JNZ	L081A
	INX	D
	INX	H
	JMP	L07F6
;
L0801:	PUSH	H
	CALL	CLRVIO
	POP	H
	JZ	L1824
;
	DB	0CDH,0A9H,02H
;
L080C:	IRPC	R,<MARKER ERROR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L0819:	MOV	A,M
L081A:	INX	H
	CPI	0EH
	RC
	CALL	L0871
	JNZ	L082B
	XRA	A
	STA	L1891
	JMP	L0819
;
L082B:	INR	C
	MOV	A,B
	CMP	C
	JNZ	L0819
	MOV	A,M
	CPI	20H
	JZ	L0849
	INX	H
	RC
	DCX	H
L083A:	MOV	A,M
	CALL	L0869
	JZ	L0849
	DCR	C
	JZ	L085B
	DCX	H
	JMP	L083A
;
L0849:	DCX	H
	MOV	A,M
	CALL	L0869
	JZ	L0849
	INX	H
	MOV	A,C
	INR	A
	CMP	B
	JNC	L0859
	INR	C
L0859:	XRA	A
	RET
;
L085B:	XRA	A
	STA	COLUMN
L085F:	XRA	A
	STA	L18CE
	LHLD	L1897
	JMP	L01B7
;
L0869:	DCR	C
	JZ	L085B
	CPI	20H
	RZ
	INR	C
L0871:	CPI	5FH
	RZ
	CPI	7CH
	RET
;
	DB	0CDH,0EEH
;
L0879:	DCR	C
	JM	L088E
	LDAX	D
	MOV	M,A
	INX	D
	INX	H
	JMP	L0879
;
L0884:	LDAX	D
	MOV	M,A
	INX	D
	INX	H
	DCR	C
	JNZ	L0884
	RET
;
	DB	2AH
;
L088E:	PUSH	B
L088F:	MVI	C,20H
L0891:	MOV	M,C
	INX	H
	MOV	A,L
	ANI	0FH
	JNZ	L0891
	CALL	L08A1
	JNZ	L088F
	POP	B
	RET
;
L08A1:	PUSH	H
	LXI	B,1050H		;NOT A LABEL
	MOV	A,H
	SBI	0F0H
	MOV	H,A
	XRA	A
L08AA:	DAD	H
	RAL
	CMP	C
	JC	L08B2
	SUB	C
	INX	H
L08B2:	DCR	B
	JNZ	L08AA
	POP	H
	ORA	A
	RET
;
; STRING SEARCH ROUTINE
;
L08B9:	CALL	L0524
	SHLD	L189B
	LXI	D,L112D
	LXI	H,VIO+370H
	CALL	L0801
	INX	H
	MVI	M,0A0H
	CALL	L108D
	LXI	H,0
	SHLD	L18A1
	SHLD	L188C
	SHLD	L18C4
	CALL	L110C
	LHLD	L18C4
	MOV	A,L
	ORA	H
	JNZ	L08ED
	LDA	L188D
	ORA	A
	JZ	L09DB
	DCX	H
L08ED:	PUSH	H
	CALL	L1148
	LDA	L188C
	MOV	B,A
	LDA	L188D
	MOV	C,A
	LHLD	L18C4
	ADD	L
	MOV	L,A
	JNC	L0902
	INR	H
L0902:	SHLD	L189B
	MOV	A,C
	PUSH	D
	CALL	L057F
	POP	D
	INX	D
	LHLD	L18C4
	XCHG
	LDA	L188D
	ORA	A
	CNZ	L11CD
	CALL	L125A
	POP	H
	DCX	H
	MOV	A,L
	ORA	H
	JNZ	L08ED
	JMP	L0681
;
	DB	0CDH,40H,04H
;
; PRINT SCOREBOARD
;
L0927:	IRPC	R,<WORD NUMBER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<PAGE NUMBER  N>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<RCRD NUMBER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<LEFT MARGIN  M>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<LINE LENGTH  L>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<LINE INDENT  I>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<PAGE LENGTH  G>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<LINE SPACNG  S>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<CHAR SPACNG  H>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<RGHT JUSTFY  J>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<FORM PAGING  F>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	IRPC	R,<PRNT LENGTH  P>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0D2H,77H,08H,0C3H,24H,09H
;
L09DB:	LDA	L188C
	ORA	A
	JZ	L085F
	CALL	L1148
	DCX	H
	CALL	L03A0
	PUSH	PSW
	PUSH	H
	JZ	L09F1
	LHLD	L1895
L09F1:	CALL	L06D6
	INX	H
	SHLD	L189B
	LXI	H,0
	SHLD	COLUMN
	SHLD	L18A1
	POP	H
	POP	PSW
	JZ	L0684
	LHLD	L1895
L0A09:	JMP	L0684
;
; DISK/TAPE I/O ROUTINES
;
L0A0C:	LXI	D,L06F3
L0A0F:	CALL	L0DED
	LXI	H,VIO+1E0H
	SHLD	L18C2
	CALL	L11DD
L0A1B:	LHLD	L18C2
L0A1E:	INX	H
	CALL	L08A1
	JNZ	L0A1E
	CALL	L06C9
	CZ	L0B07
	LDA	FCB
	ORI	30H
	MOV	M,A
	INX	H
	MVI	M,3AH
	INX	H
	MVI	M,0A0H
	CALL	L108D
	SHLD	L18C2
	LXI	D,L0A1B
	PUSH	D
	LXI	D,L18CE
	CALL	L0D72
	RC
	CPI	'C'		;CLEAR COMMAND
	JZ	L0D8E
	CPI	'R'		;READ TAPE COMMAND
	JZ	L12E6
	CPI	'W'		;WRITE TAPE COMMAND
	JZ	L128F
	CPI	'V'		;TAPE VERIFY COMMAND
	JZ	L12E7
	CPI	'D'		;DISK DIRECTORY COMMAND
	JZ	L0A80
	CPI	'L'		;DISK LOAD COMMAND
	JZ	L0B21
	CPI	'S'		;DISK SAVE COMMAND
	JZ	L0B87
	CPI	'K'		;KILL DISK FILE COMMAND
	JNZ	L0DD0
	CALL	L0C51
	CALL	L0C61
	CALL	L0C4C
	JMP	L0AA2
;
	DB	31H,0C3H,09H,01H
;
; DISK DIRECTORY COMMAND
;
L0A80:	CALL	L0C51
	CALL	L0D71
	JC	L0AA2
	CPI	3FH
	JC	L0A9F
	DCX	D
	CALL	L0C61
	LXI	B,3F03H
	LXI	H,65H
	JNZ	L0AA8
;
	DB	0CDH,07CH,0AH,11H
;
L0A9F:	CALL	L0C95
L0AA2:	CALL	L0CBB
	LXI	B,3F0BH
L0AA8:	CALL	L0CC1
	MVI	A,11H
	CALL	L0C53
	CPI	0FFH
	JZ	L0D79
	PUSH	PSW
	LXI	H,VIO+220H
	SHLD	L18C2
	CALL	L11DD
	MVI	A,20H
	STA	L18AD
	POP	PSW
L0AC5:	LXI	D,10H
	LHLD	L18C2
	DAD	D
	RRC
	RRC
	RRC
	ANI	60H
	ORI	81H
	MOV	E,A
	CALL	L06C9
	JNZ	L0AE2
	PUSH	D
	CALL	L1229
	CALL	L0B07
	POP	D
L0AE2:	SHLD	L18C2
	MVI	C,8
	CALL	L0884
	MVI	M,2EH
	INX	H
	MVI	C,3
	CALL	L0884
	MVI	A,12H
	CALL	L0C53
	ORA	A
	JP	L0AC5
	LXI	D,NCOLS
	DAD	D
	CALL	L06C9
	JZ	L1229
	RET
;
	DB	0CDH
;
L0B07:	LXI	D,VIO+230H
	LXI	H,VIO+280H
L0B0D:	MOV	A,M
	STAX	D
	INX	D
	INX	H
	CALL	L06C9
	JNZ	L0B0D
	XCHG
	PUSH	H
	CALL	L088E
	POP	H
	JNZ	0B06H		;NEVER TAKE THIS JUMP
	RET
;
L0B21:	CALL	L0C51
	CALL	L0C61
	MVI	A,0FH
	CALL	L0C53
	CPI	0FFH
	JZ	L0D79
	LHLD	BUFEND
L0B34:	MVI	A,14H
	CALL	L0C53
	ORA	A
	JNZ	L0B6E
	CALL	L13A6
	XCHG
	LXI	D,80H
L0B44:	LDAX	D
	MOV	M,A
	ORA	A
	JZ	L0B68
	INX	H
	INR	E
	JNZ	L0B44
	JMP	L0B34
;
L0B52:	CALL	L1373
;
L0B55:	IRPC	R,<DIRECTORY FULL>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0FAH,04CH,011H,021H
;
L0B68:	CALL	L0C23
	JMP	L1300
;
L0B6E:	MVI	A,10H
	CALL	L0C53
L0B73:	CALL	L1373
;
L0B76:	IRPC	R,<DISK ERROR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C2H,7CH,0BH,0C3H,4CH,11H
;
; DISK SAVE COMMAND
;
L0B87:	CALL	L0C51
	PUSH	D
	CALL	L0C61
	CALL	L1268
	CALL	L0C4C
	MVI	A,16H
	CALL	L0C53
	ORA	A
	JM	L0C2E
	MOV	A,H
	INR	A
	RLC
	MOV	B,A
	MVI	C,1
	JNC	L0BA7
	INR	C
L0BA7:	LXI	H,BUFF
L0BAA:	LDAX	D
	MOV	M,A
	INX	D
	INR	L
	JNZ	L0BAA
	MVI	A,15H
	CALL	L0C53
	ORA	A
	JNZ	L0C2E
	DCR	B
	JNZ	L0BA7
	DCR	C
	JNZ	L0BA7
	CALL	L0C23
	LXI	D,L0C0D
	LHLD	L18C2
	CALL	L1824
	INX	H
	SHLD	L18C2
	POP	D
	CALL	L0C61
	MVI	A,0FH
	CALL	L0C53
	CPI	0FFH
	JZ	L0B6E
	CALL	L0524
L0BE3:	MVI	A,14H
	CALL	L0C53
	ORA	A
	JNZ	L0B6E
	LXI	D,BUFF
L0BEF:	LDAX	D
	CMP	M
	JNZ	L0C1D
	ORA	A
	JZ	L0C00
	INX	H
	INR	E
	JNZ	L0BEF
	JMP	L0BE3
;
L0C00:	CALL	L0C23
	JMP	L0AA2
;
; "UN-MODIFY" ENCRYPTION DECODE ROUTINE
;
L0C06:	PUSH	H
	LXI	H,0B71AH
	JZ	L02AF
;
L0C0D:	IRPC	R,<VERIFYING TEXT>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	11H
;
L0C1D:	CALL	L0C4C
	JMP	L0B73
;
L0C23:	MVI	A,10H
	CALL	L0C53
	CPI	0FFH
	RNZ
	JMP	L0B73
;
L0C2E:	PUSH	PSW
	CALL	L0C4C
	POP	PSW
	JM	L0B52
	CPI	2
	JNZ	L0B73
	CALL	L1373
;
L0C3E:	IRPC	R,<DISK FULL>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C2H,7CH,0BH,0C9H
;
L0C4C:	MVI	A,13H
	JMP	L0C53
;
L0C51:	MVI	A,0DH
L0C53:	PUSH	B
	PUSH	D
	PUSH	H
	MOV	C,A
	LXI	D,FCB
	CALL	BDOS
	POP	H
	POP	D
	POP	B
	RET
;
L0C61:	CALL	L0CBB
	CALL	L0D71
	JC	L0D5E
	CPI	3FH
	JC	L0DD0
	MVI	C,8
L0C71:	MOV	M,A
	INX	H
	INX	D
	LDAX	D
	DCR	C
	JZ	L0C89
	ORA	A
	JZ	L0C82
	CPI	20H
	JNZ	L0C71
L0C82:	MVI	M,20H
	INX	H
	DCR	C
	JNZ	L0C82
L0C89:	MVI	M,'P'
	INX	H
	MVI	M,'C'
	INX	H
	MVI	M,'L'
	CALL	L0D72
	RC
;
; TEST TO INSURE DISK DRIVE BETWEEN 1 AND 4 INCLUSIVE
;
L0C95:	CPI	'1'
	JC	L0CA8
	CPI	'5'
	JNC	L0CA8
	ANI	7
	STA	FCB
	RNZ			;ALWAYS RETURN
	DB	32H,8CH,09H
;
L0CA8:	CALL	L1373
;
L0CAB:	IRPC	R,<SELECT ERROR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C9H,0CDH,0EEH
;
L0CBB:	LXI	B,20H		;32 BYTES IN FCB AFTER DRIVE SELECT
	LXI	H,FCB+1
L0CC1:	PUSH	H
L0CC2:	MOV	M,B
	INX	H
	DCR	C
	JNZ	L0CC2
	POP	H
	RET
;
L0CCA:	CPI	2EH
	JZ	L0D86
	STA	L18C4
	LXI	H,0
L0CD5:	CALL	L0D71
	CALL	L050F
	JC	L0CD5
	XRA	A
	ORA	H
	JNZ	L0D3D
	PUSH	D
	CALL	L0CF5
	POP	D
	JC	L0D3D
	CALL	L0D72
	JNC	L0CCA
	RNZ			;ALWAYS RETURN
;
	DB	22H,0AAH,09H
;
L0CF5:	LDA	L18C4
	ANI	0DFH		;CONVERT TO UPPER CASE
	CPI	'C'
	JZ	L0EC9		;CENTER FOLLOWING LINE
	CPI	'D'
	JZ	L0EF8		;SET ALL VALUES TO DEFAULT
	CPI	'F'
	JZ	L107C		;SET FORM PAGING SWITCH
	CPI	'G'
	JZ	L0F41		;SET PAGE LENGTH
	CPI	'H'
	JZ	L0F75		;SET DIABLO HMI'S
	CPI	'I'
	JZ	L0F92		;SET LINE INDENT
	CPI	'J'
	JZ	L0FB1		;SET JUSTIFICATION ON-OFF
	CPI	'L'
	JZ	L0FC3		;SET LINE LENGTH
	CPI	'M'
	JZ	L0FF1		;SET LEFT MARGIN
	CPI	'N'
	JZ	L102E		;SET PAGE NUMBER
	CPI	'P'
	JZ	L104B		;SET PRINT LENGTH
	CPI	'S'
	JZ	L105B		;SET LINE SPACING
	CPI	5EH
	JZ	L100B		;DO REVERSE LINE FEED
	STC
	RET
;
L0D3D:	LDA	L18B1
	ORA	A
	JNZ	L0D4A
	LHLD	L18C2
	MVI	M,3FH
	RET
;
L0D4A:	XRA	A
	STA	L18B1
	CALL	L158B
	CALL	L02E8
	LHLD	L18A5
	LDA	L18B1
	ORA	A
	JZ	L01B7
L0D5E:	CALL	L1373
;
L0D61:	IRPC	R,<NEED FILE NAME>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0CDH
;
L0D71:	INX	D
L0D72:	LDAX	D
	CPI	20H
	JZ	L0D71
	RET
;
L0D79:	CALL	L1373
;
L0D7C:	IRPC	R,<NOT FOUND>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L0D86:	INX	D
L0D87:	LDAX	D
	CPI	0EH
	JNC	L0D86
	RET
;
; THE VARIOUS CLEAR COMMANDS
;
L0D8E:	CALL	L0D71
	CPI	'A'
	JZ	L0DA6
	CPI	'L'
	JNZ	L0DD0
	CALL	L0D71
	CPI	'R'
	JNZ	L0DD0
	JMP	COLDST
;
L0DA6:	CALL	L0D71
	CPI	'A'
	JNZ	L0DBB
	CALL	L0524
	SHLD	BUFEND
	CALL	L1380
	JMP	L085F
;
	DB	11H
;
L0DBB:	CPI	'B'
	JNZ	L0DD0
	CALL	L0524
	XCHG
	LXI	H,TXTBUF
	CALL	L0593
	CALL	CLRMEM
	JMP	WARMST
;
L0DD0:	CALL	L1373
;
	IRPC	R,<SYNTAX ERROR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L0DE0:	PUSH	H
	CALL	L1824
	POP	H
	INX	D
	MOV	A,L
	ADI	17H
	MOV	L,A
	RNC
	INR	H
	RET
;
; PUT I/O SCOREBOARD ON SCREEN
;
L0DED:	PUSH	D
L0DEE:	CALL	CLRVIO
	LXI	D,SOM
	LXI	H,VIO+0FH
	CALL	L1824
	POP	D
	LXI	H,VIO+0A0H
	MVI	B,4
L0E00:	MOV	A,L
	ADI	8
	MOV	L,A
	CALL	L0DE0
	CALL	L0DE0
	CALL	L1824
	INX	D
	CALL	L088E
	DCR	B
	JNZ	L0E00
L0E15:	LXI	D,VIO+0E3H
	LXI	H,VIO+0BBH
	PUSH	D
	PUSH	H
	CALL	L0524
	LXI	B,0
	MOV	D,B
	MOV	E,C
L0E25:	MOV	A,M
	ORA	A
	JZ	L0E4A
	INX	H
	CPI	21H
	JC	L0E25
L0E30:	MOV	A,M
	INX	H
	CPI	21H
	JNC	L0E30
	INX	D
L0E38:	CPI	20H
	JC	L0E45
	JNZ	L0E30
	MOV	A,M
	INX	H
	JMP	L0E38
;
L0E45:	INX	B
	ORA	A
	JNZ	L0E25
L0E4A:	POP	H
	PUSH	B
	LXI	B,2006H
L0E4F:	DCX	H
	MOV	M,B
	DCR	C
	JNZ	L0E4F
	CALL	L0E5F
	POP	D
	POP	H
L0E5A:	PUSH	H
	CALL	L088E
	POP	H
L0E5F:	PUSH	H
	CALL	L0E69
	POP	H
	JMP	L0F63
;
	DB	0CDH,23H
;
L0E69:	LXI	B,7
	LXI	H,L18C7
	SHLD	L18C4
L0E72:	MOV	M,B
	INX	H
	DCR	C
	JNZ	L0E72
	XCHG
	LXI	D,0D8F0H
	CALL	L0EAC
	LXI	D,0FC18H
	CALL	L0EAC
	MVI	C,2CH
	MOV	A,B
	ORA	A
	CNZ	L0EA1
	LXI	D,-100
	CALL	L0EAC
	LXI	D,-10
	CALL	L0EAC
	LXI	D,-1
	CALL	L0EAC
	MOV	A,B
	ORA	A
	RNZ
L0EA1:	PUSH	H
	LHLD	L18C4
	MOV	M,C
	INX	H
	SHLD	L18C4
	POP	H
	RET
;
L0EAC:	MVI	A,2FH
	PUSH	H
L0EAF:	INX	SP
	INX	SP
	INR	A
	PUSH	H
	DAD	D
	JC	L0EAF
	POP	H
	MOV	C,A
	CPI	30H
	JZ	L0EC2
	MOV	B,A
	JMP	L0EA1
;
L0EC2:	MOV	A,B
	ORA	A
	JNZ	L0EA1
	RET
;
	DB	21H
;
L0EC9:	MOV	A,L
	ORA	A
	STC
	RNZ
L0ECD:	CALL	L0D87
L0ED0:	INX	D
	LDAX	D
	ORA	A
	STC
	RZ
	CPI	0EH
	JC	L0ED0
	CPI	2EH
	JZ	L0ECD
	CPI	24H
	STC
	RZ
	XCHG
	LDA	LINLEN
	MOV	B,A
	MVI	C,0
	CALL	L0819
	CMC
	RC
	MOV	A,B
	SUB	C
	RAR
	STA	L18B2
	XRA	A
	RET
;
	DB	31H
;
L0EF8:	XRA	A
	ORA	L
	STC
	RNZ
	MVI	C,0FH
L0EFE:	LXI	H,L18B2
L0F01:	MOV	M,A
	INX	H
	DCR	C
	JNZ	L0F01
	CALL	L0F2C
	CALL	L16E8
;
; FOLLOWING SERIES OF CALLS UPDATES PRINT SCOREBOARD FOR ONE
; ITEM PER CALL
;
L0F0D:	CALL	L1002		;LEFT MARGIN
	CALL	L0FE8		;LINE LENGTH
	CALL	L0FA3		;LINE INDENT
	CALL	L0F4F		;PAGE LENGTH
	CALL	L1068		;LINE SPACING
	CALL	L0F89		;HMI'S
	CALL	L0FB9		;JUSTIFICATION
	CALL	L103A		;PAGE NUMBER
	CALL	L1052		;PRINT LENGTH
	JMP	L1084		;FORM PAGING
;
	DB	3AH
;
; THIS ROUTINE UPDATES NON-ZERO DEFAULT PRINT VALUES
;
L0F2C:	MVI	A,10		;DEFAULT HMI'S
	STA	HMI
	MVI	A,80		;DEFAULT LINE LENGTH
	STA	LINLEN
	MVI	A,54		;DEFAULT PAGE LENGTH
	STA	PGLEN
	MVI	A,12		;DEFAULT PAGE SPACING
	STA	PGSPAC
	RET
;
; SET PAGE LENGTH
;
L0F41:	MOV	A,L
	CPI	73
	CMC
	RC
	ORA	A
	JNZ	L0F4C
	MVI	A,54
L0F4C:	STA	PGLEN
L0F4F:	LDA	PGLEN
	LXI	H,VIO+159H
L0F55:	MVI	D,0
	MOV	E,A
	MVI	M,20H
	DCX	H
	MVI	M,20H
	DCX	H
	PUSH	H
	CALL	L0E69
	POP	H
L0F63:	LXI	D,L18C7
L0F66:	LDAX	D
	ORA	A
	RZ
	MOV	M,A
	INX	D
	INX	H
	JNZ	L0F66		;THIS JUMP ALWAYS TAKEN
;
	DB	02AH,0AAH,09H,0C3H,02BH,0FH
;
; SET HMI'S FOR THE DIABLO
;
L0F75:	MOV	A,L
	ORA	A
	JNZ	L0F7C
	MVI	A,10
L0F7C:	CPI	8
	RC
	CPI	51
	CMC
	RC
	STA	HMI
	CALL	L16EB
L0F89:	LDA	HMI
	LXI	H,VIO+187H
	JMP	L0F55
;
; SET LINE INDENTATION
;
L0F92:	MOV	A,L
	CPI	101
	CMC
	RC
	LDA	LINLEN
	SUB	L
	RC
	CPI	25
	RC
	MOV	A,L
	STA	LINDENT
L0FA3:	LDA	LINDENT
	LXI	H,0F137H
	JMP	L0F55
;
L0FAC:	DB	'PAGE '
;
; SET JUSTIFICATION ON-OFF SWITCH
;
L0FB1:	MOV	A,L
	CPI	2
	CMC
	RC
	STA	JUSTSW
L0FB9:	LDA	JUSTSW
	LXI	H,VIO+1A9H
	JMP	L0F55
;
	DB	11H
;
L0FC3:	MOV	A,L
	ORA	A
	JNZ	L0FCB
	MVI	A,80
	MOV	L,A
L0FCB:	CPI	25
	RC
	CPI	126
	CMC
	RC
	LDA	LMARGN
	ADD	L
	CPI	126
	CMC
	RC
	LDA	LINDENT
	MOV	H,A
	MOV	A,L
	SUB	H
	RC
	CPI	25
	RC
	MOV	A,L
	STA	LINLEN
L0FE8:	LDA	LINLEN
	LXI	H,VIO+120H
	JMP	L0F55
;
L0FF1:	MOV	A,L
	CPI	101
	CMC
	RC
	LDA	LINLEN
	ADD	L
	CPI	126
	CMC
	RC
	MOV	A,L
	STA	LMARGN
L1002:	LDA	LMARGN
	LXI	H,VIO+109H
	JMP	L0F55
;
; DO REVERSE LINE FEED
;
L100B:	LDA	L18B1
	ORA	A
	STC
	RZ
	MOV	A,L
	ORA	A
	JNZ	L1017
	INR	A
L1017:	MOV	C,A
	LXI	H,PGLEN
	MOV	A,M
	INR	A
	INX	H
	SUB	M
	SUB	C
	RC
L1021:	CALL	L178A
	CALL	L1798
	INR	M
	DCR	C
	JNZ	L1021
	RET
;
	DB	2AH
;
; ROUTINE TO SET PAGE NUMBER
;
L102E:	MOV	A,L
	ORA	A
	JZ	L1034
	DCR	A
L1034:	STA	PGNMBR
	STA	L18BD
L103A:	LDA	PGNMBR
	INR	A
	LXI	H,VIO+0D0H
	JMP	L0F55
;
L1044:	IRPC	R,< TIME>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	01H
;
L104B:	MOV	A,L
	STA	PRTLEN
	STA	L18BF
L1052:	LDA	PRTLEN
	LXI	H,VIO+1D7H
	JMP	L0F55
;
; ROUTINE TO SET LINE SPACING
;
L105B:	MOV	A,L
	CPI	6
	CMC
	RC
	ORA	A
	JZ	L1065
	DCR	A
L1065:	STA	LINSPCNG
L1068:	LDA	LINSPCNG
	INR	A
	LXI	H,VIO+170H
	JMP	L0F55
;
L1072:	IRPC	R,<LOCATED ">
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
; SET FORMS PAGING SWITCH
;
L107C:	MOV	A,L
	CPI	2
	CMC
	RC
	STA	FMPGSW
L1084:	LDA	FMPGSW
	LXI	H,VIO+1C0H
	JMP	L0F55
;
L108D:	LXI	B,42H
	LXI	D,L18CE
	PUSH	D
	XRA	A
L1095:	STAX	D
	INX	D
	DCR	C
	JNZ	L1095
	POP	D
L109C:	CALL	L125F
	MOV	C,A
	CPI	7FH
	JNZ	L10C7
	MOV	A,B
	ORA	A
	JZ	L109C
	MVI	M,20H
	DCR	B
	DCX	D
	XRA	A
	STAX	D
	DCX	H
	MVI	M,0A0H
	JMP	L109C
;
L10B6:	IRPC	R,<CAN NOT LOCATE ">
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L10C7:	CPI	0DH
	JNZ	L10D0
	MVI	M,20H
	INX	H
	RET
;
L10D0:	CPI	'/'
	JZ	L10DA
	CPI	'#'
	JNZ	L10F0
L10DA:	MOV	A,B
	ORA	A
	JZ	L109C
	JMP	L10F6
;
L10E2:	IRPC	R,<PRINT COUNTER>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L10F0:	CPI	20H
	JC	L109C
	MOV	A,B
L10F6:	CPI	3FH
	JZ	L109C
	MOV	A,C
	MOV	M,C
	CPI	2FH
	JNZ	L1103
	XRA	A
L1103:	STAX	D
	INR	B
	INX	D
	INX	H
	MVI	M,0A0H
	JMP	L109C
;
L110C:	LXI	H,L18CE
	CALL	L113D
	ORA	A
	RZ
	STA	L188C
L1117:	CALL	L113D
	STA	L188D
	XCHG
	LXI	H,0
L1121:	LDAX	D
	INX	D
	CALL	L050F
	RNC
	SHLD	L18C4
	JMP	L1121
;
L112D:	IRPC	R,<SEARCH STRING?>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C9H
;
L113D:	MVI	B,0FFH
L113F:	MOV	A,M
	INX	H
	INR	B
	ORA	A
	JNZ	L113F
	MOV	A,B
	RET
;
L1148:	LHLD	L189B
	DCX	H
L114C:	LXI	D,L18CE
	LDAX	D
	MOV	B,A
L1151:	INX	H
	MOV	A,M
	ORA	A
	JZ	L117E
	CMP	B
	JNZ	L1151
	SHLD	L18C4
L115E:	INX	H
	INX	D
	LDAX	D
	CMP	M
	JZ	L115E
	CPI	23H
	JZ	L115E
	ORA	A
	JZ	L1174
	LHLD	L18C4
	JMP	L114C
;
L1174:	PUSH	H
	LHLD	L18A1
	INX	H
	SHLD	L18A1
	POP	H
	RET
;
L117E:	STA	L188C
	LHLD	L18A1
	MOV	A,L
	ORA	H
	JZ	L11B2
	XCHG
	CALL	L0E69
	LXI	D,L1072		;THIS MIGHT NOT BE A LABEL
	CALL	L11BE
	INX	H
	INX	H
	CALL	L0F63
	LXI	D,L1044		;THIS MIGHT NOT BE A LABEL
	CALL	L1824
	LDA	L18C8
	ORA	A
	JNZ	L11AD
	LDA	L18C7
	CPI	31H
	JZ	L11B8
L11AD:	MVI	M,53H
	JMP	L11B8
;
L11B2:	LXI	D,L10B6
	CALL	L11BE
L11B8:	CALL	L125F
	JMP	L11B8
;
L11BE:	LXI	H,VIO+370H
	CALL	L0801
	LXI	D,L18CE
	CALL	L13C0
	MVI	M,22H
	RET
;
L11CD:	MOV	B,A
L11CE:	MOV	A,M
	ANI	7FH
	STAX	D
	INX	D
	INX	H
	DCR	B
	JNZ	L11CE
	RET
;
	DB	03AH
;
; ROUTINE TO CLEAR VIO SCREEN
;
CLRVIO:	LXI	H,VIO
L11DD:	MVI	B,' '
L11DF:	MVI	A,(VIO+(NCOLS*NROWS)) AND 0FFH
L11E1:	MOV	M,B
	INX	H
	CMP	L
	JNZ	L11E1
	MVI	A,((VIO+(NCOLS*NROWS)) SHR 8) AND 0FFH
	CMP	H
	JNZ	L11DF
	RET
;
; SPEED/MODE CONTROL FOR SCROLLING
;
L11EE:	CPI	'9'+1
	JNC	L1216
	CPI	'0'
	JZ	L120D
	JC	L1216
	ANI	0FH
	PUSH	B
	MOV	B,A
	XRA	A
	STC
L1201:	STA	SCRLSPD
	RAL
	DCR	B
	JNZ	L1201
	POP	B
	XRA	A
	RET
;
	DB	21H
;
; SET PAGE MODE SCROLL
;
L120D:	MVI	A,0FFH
	STA	L1888
	STA	L188B
	RET
;
; CHARS OTHER THAN 0-9
;
L1216:	ANI	3FH
	STA	L188E
	RET
;
; DELAY TIMER FOR SCROLLING MODE
;
L121C:	LDA	SCRLSPD
	MOV	B,A
	MVI	C,0FFH
	XRA	A
L1223:	DCX	B
	CMP	B
	JNZ	L1223
	RET
;
L1229:	CALL	L125A
	CNZ	L11EE
	CPI	20H
	JZ	L123A
	LDA	L18AD
	CPI	20H
	RNZ
L123A:	CALL	L125F
	STA	L18AD
	CPI	20H
	JZ	L1250
	CPI	0DH
	JZ	L1255
	CALL	L11EE
	JMP	L123A
;
L1250:	XRA	A
	STA	L188B
	RET
;
L1255:	XRA	A
	STA	L1888
	RET
;
L125A:	CALL	CONST
	ORA	A
	RZ
L125F:	CALL	CONIN
	CPI	1BH
	JZ	L085F
	RET
;
L1268:	CALL	L0524
	XCHG
	LHLD	BUFEND
	MOV	A,L
	SUB	E
	MOV	L,A
	MOV	A,H
	SBB	D
	MOV	H,A
	ORA	L
	RNZ
	CALL	L1373
;
L127A:	IRPC	R,<NO TEXT AFTER CURSOR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
; TAPE WRITE ROUTINE
;
L128F:	CALL	L1268
	XCHG
	INX	D
	MVI	A,3CH
	CALL	L12D4
	MVI	A,0E6H
L129B:	CALL	L12D4
	LXI	B,0FFH
	MOV	A,D
	ORA	A
	JNZ	L12A7
	MOV	C,E
L12A7:	MOV	A,C
	CALL	L12D4
L12AB:	MOV	A,M
	CALL	L12D4
	ADD	B
	MOV	B,A
	INX	H
	DCX	D
	MOV	A,D
	ORA	E
	JZ	L12C0
	DCR	C
	JNZ	L12AB
	MOV	A,B
	JMP	L129B
;
L12C0:	MOV	A,B
	CALL	L12D4
	XRA	A
	CALL	L12D4
	CALL	L1373
;
L12CB:	IRPC	R,<WRITTEN>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C9H
;
; PHYSICAL TAPE WRITE ROUTINE
;
L12D4:	PUSH	PSW
	PUSH	B
L12D6:	CALL	L135B
	IN	6EH
	ANI	20H
	JNZ	L12D6
	POP	B
	POP	PSW
	OUT	6FH
	RET
;
	DB	01H
;
L12E6:	XRA	A
L12E7:	STA	L18C4
	LHLD	BUFEND
	MVI	A,10H
	OUT	6EH
L12F1:	CALL	L134E
	ORA	A
	JNZ	L1310
	LDA	L18C4
	ORA	A
	JNZ	L1342
	DCX	H
L1300:	SHLD	BUFEND
	CALL	L0E15
	CALL	L1370
;
L1309:	IRPC	R,<READY>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	0C9H
;
L1310:	MOV	E,A
	MVI	B,0
L1313:	CALL	L134E
	MOV	C,A
	PUSH	D
	CALL	L13A6
	XCHG
	POP	D
	LDA	L18C4
	ORA	A
	MOV	A,C
	JNZ	L1327
	MOV	M,A
	INX	H
L1327:	ADD	B
	MOV	B,A
	DCR	E
	JNZ	L1313
	CALL	L134E
	CMP	B
	JZ	L12F1
	CALL	L1370
;
L1337:	IRPC	R,<TAPE ERROR>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
L1342:	CALL	L1373
	INX	D
	INX	B
	DCR	D
	LXI	B,L030F
	MVI	C,8
	MOV	C,L
L134E:	CALL	L135B
	IN	6EH
	ANI	10H
	JNZ	L134E
	IN	6FH
	RET
;
L135B:	CALL	CONST
	ORA	A
	RZ
	CALL	CONIN
	CPI	1BH
	RNZ
	CALL	L1370
;
L1369:	IRPC	R,<BREAK>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
	DB	01H
;
L1370:	CALL	CLRMEM
L1373:	POP	D
	LXI	SP,L1880
	LHLD	L18C2
	JMP	L1824
;
; CLEAR MEMORY UP TO BASE OF CP/M
;
CLRMEM:	LHLD	BUFEND
L1380:	LDA	BDOS+2
	MVI	B,0
L1385:	MOV	M,B
	INX	H
	CMP	H
	JNZ	L1385
	RET
;
L138C:	XCHG
	LHLD	MEMTOP
	CALL	L0446
	RNC
	LXI	D,L13B1
L1397:	LXI	H,VIO+38EH
	CALL	L0801
	CALL	CLRMEM
L13A0:	CALL	L125F
	JMP	L13A0
;
L13A6:	XCHG
	LHLD	MEMTOP
	CALL	L0446
	RNC
	CALL	L1370
;
L13B1:	IRPC	R,<FILE AREA FULL>
	DB	'&R' XOR ($ AND 0FFH)
	ENDM
	DB	$ AND 0FFH
;
; ROUTINE TO PRINT AN ENCRYPTED MESSAGE
;
L13C0:	LDAX	D		;INSTRUCTION GETS MODIFIED
	ORA	A		;BECOMES XRA E
	RZ
	MOV	M,A
	INX	D
	INX	H
	JMP	L13C0
;
; ENTRY INTO THE PRINT SUB SYSTEM
;
L13C9:	LDA	RPTCMD
	ORA	A
	CZ	L065D
	CALL	L0524
	SHLD	L18A5
	LDA	L18AC
	ORA	A
	JNZ	L1417
	STA	INSFLG
	LXI	D,L0927
	CALL	L0DED
	CALL	L0F0D
	LXI	H,VIO+2CEH
L13EC:	INX	H
	INX	H
	MVI	M,0A0H
	CALL	L108D
	SHLD	L18C2
	LXI	D,L18CE
	CALL	L0D72
	CNC	L0CCA
	JNC	L13EC
	LDA	RPTCMD
	STA	L18AC
	LXI	H,VIO+2D0H
	CALL	L11DD
	LXI	D,L10E2
	LXI	H,VIO+2F0H
	CALL	L1824
L1417:	LHLD	RPTCNT
	INX	H
	XCHG
	LXI	H,VIO+395H
	CALL	L0E5A
	CALL	L142E
	LHLD	RPTCNT
	MOV	A,L
	ORA	H
	JZ	L0681
	RET
;
L142E:	LXI	H,PGNMBR
	MOV	A,M
	INX	H
	MOV	M,A
	INX	H
	MOV	A,M
	INX	H
	MOV	M,A
	INX	H
	MOV	A,M
	INX	H
	MOV	M,A
	CALL	L1834
	SHLD	L18A3
	PUSH	H
	CALL	L17F7
	POP	H
	CALL	L16E8
L144A:	CALL	L1594
	JNZ	L1453
	CALL	L1834
L1453:	LHLD	L18A5
	MOV	D,H
	MOV	E,L
	LDA	HMI
	STA	L18B7
	LDA	L18AF
	MOV	B,A
	STA	L18B0
	XRA	A
	STA	L18AE
	STA	L18AF
	LDA	LINDENT
	ADD	B
	CALL	L07CD
	JC	L1513
	PUSH	H
	SHLD	L18A5
	MOV	A,B
	SUB	C
	MOV	B,A
	JZ	L149B
	PUSH	B
	LXI	H,L18B7
	MOV	C,M
	XRA	A
L1486:	ADD	C
	DCR	B
	JNZ	L1486
	POP	B
	MOV	B,A
L148D:	MOV	A,C
	SUB	B
	JNC	L149A
	CMA
	INR	A
	MOV	B,A
	INR	M
	JMP	L148D
;
	DB	01H
;
L149A:	MOV	C,A
L149B:	POP	H
	CALL	L1678
	JNZ	L14B3
	CALL	L16D5
	CALL	L16FB
	MOV	C,B
	CALL	L16D5
	CALL	L16FB
	JM	L14E6
;
	DB	21H
;
L14B3:	PUSH	B
	LDA	JUSTSW
	ORA	A
	JZ	L14CA
	MOV	A,B
	ADD	C
	MOV	C,A
	LDA	LINDENT
	ADD	C
	MOV	C,A
	LDA	L18B0
	ADD	C
	JMP	L14CE
;
L14CA:	LDA	LINLEN
	INR	A
L14CE:	MOV	C,A
	CALL	L16B2
	POP	B
	CALL	L16D5
	CALL	L16F1
	MOV	C,B
	CALL	L16D5
	CALL	L16F1
	JM	L14E6		;ALWAYS JMP
;
	DB	22H,8CH,09H
;
L14E6:	CALL	L16E8
L14E9:	LDA	LINSPCNG
	MOV	C,A
	LXI	H,L18C1
L14F0:	DCR	M
	JZ	L14FE
	CALL	L1798
	DCR	C
	JP	L14F0
	JMP	L1453
;
L14FE:	CALL	L1504
	JMP	L144A
;
L1504:	CALL	L1790
	LDA	FMPGSW
	ORA	A
	RZ
L150C:	CALL	L17E4
	JNC	L150C
	RET
;
L1513:	STA	L18C6
	ORA	C
	JZ	L158B
	SHLD	L18A5
	MOV	A,C
	ORA	A
	JZ	L156C
	CALL	L1678
	JNZ	L1537
	CALL	L16E8
	CALL	L16FB
	JM	L154C		;ALWAYS JUMP
;
	DB	0CDH,70H,0DH,02AH,0AAH,09H
;
L1537:	DCX	H
	DCX	H
	DCR	C
	PUSH	B
	LDA	LINDENT
	ADD	C
	MOV	C,A
	LDA	L18B0
	ADD	C
	MOV	C,A
	CALL	L16B2
	POP	B
	CALL	L16F1
L154C:	XRA	A
	STA	L1885
	STA	L18B2
	STA	L1892
	CALL	L1834
	CALL	L16E8
	LXI	H,L18BF
	MOV	A,M
	ORA	A
	JZ	L156F
	DCR	M
	JNZ	L156F
	JMP	L157D
;
	DB	11H
;
L156C:	CALL	L1834
L156F:	CALL	L17F4
	LDA	L18C6
	CPI	0CH
	JZ	L14FE
	JNC	L14E9
L157D:	LDA	L18C6
	CPI	0CH
	JNZ	L158B
	CALL	L1790
	JMP	L158E
;
L158B:	CALL	L1798
L158E:	MVI	A,0DH
	JMP	LIST
;
	DB	01H
;
L1594:	XRA	A
	STA	L1891
	CALL	L17A0
	LDA	PGLEN
	STA	L18C1
	XCHG
	LHLD	L18A3
	XCHG
	SHLD	L18A3
	CALL	L15B1
	RZ
	XCHG
	SHLD	L18A3
L15B1:	MOV	A,M
	CPI	24H
	RNZ
	INX	H
	LDA	LINLEN
	MOV	B,A
	MVI	C,0
	CALL	L0819
	CPI	0DH
	RNZ
	MOV	A,B
	SUI	0AH
	CMP	C
	RC
	LDA	L1885
	PUSH	PSW
	LDA	L1892
	PUSH	PSW
	LDA	L18B2
	PUSH	PSW
	XRA	A
	STA	L1892
	STA	L18B2
	STA	L1885
	CALL	L1678
	XCHG
	PUSH	H
	LHLD	L18A3
	INX	H
	MOV	B,C
	CALL	L16FB
	MOV	A,M
	CALL	L0871
	JNZ	L15FC
	CALL	L1735
	INX	H
	MOV	A,M
	CALL	L0871
	CZ	L1735
L15FC:	LDA	LINLEN
	SUI	6
	MOV	C,A
	LXI	H,L18BD
	INR	M
	JNZ	L160A
	INR	M
L160A:	MOV	A,M
	CPI	0AH
	JC	L1617
	CPI	64H
	JC	L1616
	DCR	C
L1616:	DCR	C
L1617:	MOV	A,C
	SUB	B
	MOV	C,A
L161A:	MVI	A,20H
	CALL	L1746
	DCR	C
	JNZ	L161A
	LXI	H,L0FAC
	MVI	C,5
	CALL	L16FB
	LXI	H,L18BD
	MOV	E,M
	MVI	D,0
	CALL	L0E69
	MVI	C,0FFH
	LXI	H,L18C7
	PUSH	H
L163A:	INR	C
	MOV	A,M
	INX	H
	ORA	A
	JNZ	L163A
	POP	H
	CALL	L16FB
	LXI	H,L18C1
	LDA	LINSPCNG
	MOV	C,A
	INR	C
L164D:	CALL	L1798
	DCR	M
	DCR	C
	JP	L164D
	CALL	L16E8
	LHLD	L18A5
	POP	D
	CALL	L0446
	JNC	L1666
	XCHG
	SHLD	L18A5
L1666:	POP	PSW
	STA	L18B2
	POP	PSW
	STA	L1892
	POP	PSW
	STA	L1885
	XRA	A
	RZ			;ALWAYS RETURN
;
	DB	02AH,0AAH,09H,11H
;
L1678:	CALL	L178A
	LDA	L1891
	CMA
	STA	L1891
	ORA	A
	JNZ	L169E
	LDA	L1892
	ORA	A
	JNZ	L169E
	LDA	L1885
	ORA	A
	JNZ	L169E
	MVI	A,36H
	CALL	LIST
	INR	C
	JZ	0924H		;JUMP NEVER TAKEN
	RET
;
L169E:	MVI	A,35H
	CALL	LIST
	XCHG
	PUSH	B
	LDA	LINDENT
	INR	A
	MOV	C,A
	LDA	L18B0
	ADD	C
	MOV	C,A
	JMP	L16B3
;
L16B2:	PUSH	B
L16B3:	LDA	L18B2
	ADD	C
	MOV	C,A
	LDA	LMARGN
	ADD	C
	MOV	C,A
	CALL	L16C9
	POP	B
	XRA	A
	STA	L18B0
	JNZ	0D70H		;NEVER TAKEN
	RET
;
L16C9:	CALL	L178A
	MVI	A,9
	CALL	LIST
	MOV	A,C
	JMP	LIST
;
L16D5:	LDA	JUSTSW
	ORA	A
	RNZ
L16DA:	PUSH	B
	LDA	L18B7
	INR	A
	STA	L18B7
	MOV	C,A
	CALL	L177E
	POP	B
	RET
;
L16E8:	LDA	HMI
L16EB:	STA	L18B7
	JMP	L16DA
;
L16F1:	DCR	C
	RM
	MOV	A,M
	DCX	H
	CALL	LIST
	JMP	L16F1
;
L16FB:	DCR	C
	RM
	MOV	A,C
	ANI	1FH
	JNZ	L170A
	XRA	A
	STA	L18AE
	CALL	L17A0
L170A:	MOV	A,M
	INX	H
	CALL	L0871
	JZ	L1718
	CALL	L1746
	JMP	L16FB
;
L1718:	CALL	L1735
	JMP	L170A
;
L171E:	CPI	5FH
	JNZ	L172C
	LDA	L1892
	CMA
	STA	L1892
	RZ
;
	DB	3EH
;
L172C:	LDA	L1885
	CMA
	STA	L1885
	RNZ
;
	DB	11H
;
L1735:	CALL	L171E
	RZ
	ORA	A
	RNZ
	PUSH	B
	LDA	L18B7
	MOV	C,A
	CALL	L177E
	POP	B
	RET
;
	DB	3EH
;
L1746:	STA	L18C4
	LDA	L1885
	ORA	A
	LDA	L18C4
	JZ	L176C
	PUSH	B
	MOV	B,A
	MVI	C,2
	CALL	L177E
	MOV	A,B
	CALL	LIST
	LDA	L18B7
	DCR	A
	MOV	C,A
	CALL	L177E
	MOV	A,B
	CALL	L176C
	POP	B
	RET
;
L176C:	CALL	LIST
	LDA	L1892
	ORA	A
	RZ
	MVI	A,8
	CALL	LIST
	MVI	A,5FH
	JMP	LIST
;
L177E:	CALL	L178A
	MVI	A,1FH
	CALL	LIST
	MOV	A,C
	JMP	LIST
;
L178A:	MVI	A,1BH
	JMP	LIST
;
	DB	2AH
;
L1790:	CALL	L16E8
	MVI	A,0CH
	JMP	L179A
;
L1798:	MVI	A,0AH
L179A:	STA	L18AE
	CALL	LIST
L17A0:	MVI	A,3
	CALL	LIST
	LDA	L18AD
	CPI	20H
	JZ	L17C5
	CPI	1BH
	JZ	L17C5
L17B2:	CALL	CONIN
	STA	L18AD
	CPI	6
	RZ
	CPI	20H
	JZ	L17C5
	CPI	1BH
	JNZ	L17B2
L17C5:	CALL	CONIN
	CPI	6
	JNZ	L17C5
	LDA	L18AE
	ORA	A
	RZ
	XRA	A
	STA	L18AE
	LDA	L18AD
L17D9:	CPI	1BH
	JNZ	L17E4
	CALL	L158E
	JMP	L085F
;
L17E4:	CALL	CONIN
	STA	L18AD
	CPI	20H
	RZ
	CPI	0DH
	JNZ	L17D9
	STC
	RET
;
L17F4:	LHLD	L18A5
L17F7:	MVI	B,0
L17F9:	MOV	A,M
	CPI	20H
	JNZ	L1804
	INX	H
	INR	B
	JMP	L17F9
;
L1804:	SHLD	L18A5
	STA	L1886
	LDA	LINDENT
	MOV	C,A
	LDA	LINLEN
	SUB	C
	SUB	B
	JC	L1820
	CPI	14H
	JC	L1820
	MOV	A,B
L181C:	STA	L18AF
	RET
;
L1820:	XRA	A
	JMP	L181C
;
L1824:	SUB	A
	MVI	A,54H
	CALL	L02AA
	CALL	L13C0
	JZ	L0C06		;ALWAYS JMP
;
	DB	0CDH,0A9H,02H,02AH
;
L1834:	LHLD	L18A5
	MOV	A,M
	CPI	2EH
	RNZ
	XCHG
L183C:	CALL	L0D71
	CPI	0DH
	POP	H
	JZ	L157D
	PUSH	H
	STA	L18B1
	CALL	L0CCA
	INX	D
	LDAX	D
	CPI	2EH
	JZ	L183C
	XCHG
	SHLD	L18A5
	XRA	A
	STA	L18B1
	RET
;
	ORG	BASE+1880H
;
L1880:	DB	0,0,0,0
SCRLSPD:DS	1
L1885:	DS	1
L1886:	DS	1
L1887:	DS	1
L1888:	DS	1
L1889:	DS	1
INSFLG:	DS	1
L188B:	DS	1
L188C:	DS	1
L188D:	DS	1
L188E:	DS	1
COLUMN:	DS	1
ROW:	DS	1
L1891:	DS	1
L1892:	DS	1
MEMTOP:	DS	2
L1895:	DS	2
L1897:	DS	2
L1899:	DS	2
L189B:	DS	2
L189D:	DS	2
BUFEND:	DS	2
L18A1:	DS	2
L18A3:	DS	2
L18A5:	DS	2
L18A7:	DS	2
RPTCNT:	DS	2
RPTCMD:	DS	1
L18AC:	DS	1
L18AD:	DS	1
L18AE:	DS	1
L18AF:	DS	1
L18B0:	DS	1
L18B1:	DS	1
L18B2:	DS	1
LINDENT:DS	1
JUSTSW:	DS	1
FMPGSW:	DS	1
HMI:	DS	1
L18B7:	DS	1
LINLEN:	DS	1
LINSPCNG:DS	1
LMARGN:	DS	1
PGSPAC:	DS	1
PGNMBR:	DS	1
L18BD:	DS	1
PRTLEN:	DS	1
L18BF:	DS	1
PGLEN:	DS	1
L18C1:	DS	1
L18C2:	DS	2
L18C4:	DS	2
L18C6:	DS	1
L18C7:	DS	1
L18C8:	DS	6
L18CE:	DS	1
;
	ORG	L18CE+(1911H-18CEH)
;
TXTBUF:	DS	1
;
        END

