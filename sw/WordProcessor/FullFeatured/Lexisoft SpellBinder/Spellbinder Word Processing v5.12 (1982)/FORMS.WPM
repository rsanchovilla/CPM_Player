###   7/7/82    FORMS2.14      Requires SB version 5.1 or later                    *** FORMS PROCESSOR **   This macro lets you fill out a forms template which previouslyhas been mapped to a printed form.   Provided the files have been set up correctly, you can accessa customer list, keep a form log, do calculations, etc.##A          "ORDER"       "Filename of form to be filled in        "B           "none"   "Datafile if applicable or 'NONE'        "C              "0"       "Tax Rate in tenths if applicable        "E              "0"           "Clean Print file (1=yes; 0=no)          "H              "1"           "Clean Character (null=0 space =1)       "F              "0"           "Exit to Boiler.WPM (1=yes; 0=no)        "G             "  "       "Boiler Master File if Yes               "#;                         SETUP    FORMS2.14:ss 50 10 15 5 50 5 5 5 5  5;   A  B  C  D E  F G H I  J;   A=Input, B=scratch, C=Date, D=         E=Spacefill;   F        G=Dfile len, H        I = message;             K=INV NO L=Item No.   0 = AAAAA:%J = "QUIT":%Q = "":%1= $H:on %1 / /+1 /:%Q = " ";;PROCESS TEM FILE:pr "#1/#3/#3/#3/#3/#6/":pr "     Filename of form to be filled in:   $A"ro/$A.TEM/ri/j2/e/s//.e<</t          ;get it and install .e:%K = !                 ;get last form numbers/[d:on ?-3 / /+1 /:in "#1/#13/#13/#13/Date:  "%Ct/d2/h1000             ;delete number and hold form;;;PROCESS PRN FILEro/$A.PRN/;           GET PRN FILE IF IT EXISTS:on $0 /+1 /+1 /r/d1/e:%1=$3                ;Code length of file:%G=%1t/fy/wo/$A.PRN/w/d1000             ;Spool it thru and delete from work space;;;PROCESS DATA FILE:%A = "$B"              ;Determine if datafile requested:%D = "none":on %A%D / /+2 /ro/%A/                  ;Get data file if one requestedr:%O = "AAAA"e/s//^</:on $0 / / 466;;;SETUP BETWEEN FORMS:%d = 0:%c = 0:%L = "0"t/u:cp;;:%P=0s/@:on ?-3 / /+1:%P=1t;;;;;;;;DETERMINE FIELD PARAMETERSS/[:%1 = $2+1      ;determine start of field:mc %1-2:%8=?:mc %1               ;Are there special form commands?:%4 = ?:%D = !:on ?-3 / 170   ;EXIT if there are no more entries:mc %1s/]:%5 = $3-1      ;code line number:%2 = $2        ;determine end of field:%3 = %2-%1     ;determine field length:on %4-32 / / 260  ;goto command processor if not space;;MANUAL ENTRY:mc %1:cm             ;move cursor to spot:IN %A          ;read the entry;;;;SPECIAL STRING CHECKER;;;;;;;;;;;;;;;;;;;;;:%B = "quit":on %A%B / 190 /;;:%B = "kill":on %A %B 129 / 129:%6 = %K          ;down date form number:%6=%6-1b/s/%K//d:%K = %6t/s/.e:%6=$3t/d%6/u:cp:on -1 65;;;;:%B = "done":on %A%B 138 / 138f:on -1 65;;;;;;ENTRY HANDLER:mc %1:sl %A %2:%9 = %3-%2:sf %E %9:sf %A %2;s/?]/^]/        ;find the end of the field:mc %1:cm:on %4-50  / /+5 /:on %4-101 / /+7 /  ;e field handler:on %4-51  / /+3 /:on %A%O / / /+2:%A = "%E%A":on -1 /+3:%A = "%A%E";;:on %8-64  /+4 / /+4 ; @ - stuff in data file if indicatede/s//%A/:%8=0t/f%5:mc %1;se %A:pr "%A"d/s/?/%A?/:mc %1:on -1 65;;;;;END OF FORM PROCESSORe/s//</t/s/.e:%1 = $3+1tw%1:on %A%B / /+8 /d%1:on -1 45;;;;;;;;;;;:pr "#1/#3/#3/#3/HANG ON WHILE PROCESSING"wd               ;close scratch file:%1=%P:on %1 /+6 /+6 /:pr "#0/#13/   Processing data file..."e/b/f1/ro/$A.DAT/  ;process data file:on $0 /+1 /+1 /riwo/$A.DAT/w/wd/d1000:pr "#0/#13/   Processing template file..."e/u/s//%K</fy   ;      update invoice template:%1 = $3-1s/.eb0/d5000t/f%1/b1wo/$A.TEM/W/wd             ;and write it outt/d5000;:pr "#13/   Processing print file...";PROCESS PRN FILEro/$A.PRN/         ;Get filewo/$A.PRN/:%6 = $E:on %6 / / /+2gd:on -1 /+15:%1=%Gw%1                     ;write out portion that doesn't need cleaningr1t/s/[/%Q/                ;Remove commands and other syntax:%1=?                   ;one line at a time:on %1-20 /+2 / /:on %1-127 /-4 / /s/?/ /:on ?-3 / / /-6t/sa/]/%Q/t/sa/@/%Q/t/sa/\?/%Q/t/w1/d1:ON $0 / / /-12         ;if read file still open, get another linewd                      ;otherwise close write fileh0/t                    ;clear hold buffer and exit:%1 = $F:on %1 / 500 /;;ro/boiler.wpm/rs//:on -1 95/f14/d1/s//:on -1 \/<s/\/??/\/$A.prn/f3/d1/s//:on -1 \/<s/\/??/\/$G/f4/d1/s//:on -1 \/<s/\/??/\/$A.prn/t/f95/s/0/1/tal;;;SPECIAL COMMANDS:%B="KILL":on %A%B / 114 /:%B="done":on %A%B 138 129 138;;;COMMAND PROCESSOR:on %8-63  / 450 / ;?:pr "#0/#6/type QUIT to quit  KILL to delete DONE to complete":cm;;;;;:on %4-102 /+20 / /+20          ; f -  Find a file:mc %1:cm;:in %As/*%A:on ?-3 /+3 / /+3        ;Search for customer record:%7 = 1                  ;if not found set flagt/f%5:on -1 254b1:on ?-13 /-2 / /-2f1:%6 = $3                 ;if found code line number and:%7 = 0                  ;reset flag:%H=%6t/f%5:on -1 254;;;:on %4-49  /+14 / /            ; line numbers of customer record:on %4-57  / / /+13:on %7 / / 81:%M = %4:%4 = %Dt/f%6-1f%4:%A = !<t/f%5:%4 = %M:on -1 254;;;;:on %4-120 /+10 / /+10      ;x - multiply:mc %1:cm:in %A              ;allow for done to be entered on this item:on %A%B / 129 /      ;check for done here:%7 = %A              ;multiplican passed to next routine in %7:on -1 254;;;;:on %4-121 /+14 / /+14      ;y - multiply:mc %1:cm:in %A:%a = %A:on %7   / /+3                  ;! multiplication loop:fa %b%a %b=%b+%a               ;!:%7 = %7-1                      ;!:on -1 /-4                      ;!:on -1 254;;;;;:on %4-112 /+9 / /+9          ;p - product:%A = "%b":fa %c%b %c = %c+%b:%b = 0:on -1 254;;;;;:on %4-97  /+9 / /+9          ;a - sum:mc %1:cm:in %a:fa %c%a %c=%c+%a:%A = "%a":on -1 254;;;:on %4-116 /+9 / /+9          ;t - total:%A = "%c":on -1 254;;;;;;;:on %4-99  /+14 / /+14         ;c - intraform counter;:%6=%L:%6 = %6+1:%L= %6:%A = %6t/f%5:on -1 254;;;;;;;:on %4-111 /+14 / /+14       ;o - interform counter:pr "#0/#6/Hit RETURN for next number, enter new number, or type QUIT":mc %1:cm:in %A             ;Enter number:on %A%J / 190 /:sl %A %6          ;If number is 0 length, i.e. CR get next:on %6 / / 254      ;otherwise accept number inputf/f/f2:%6=%K:%6=%6+1:%K=%6:%A = %6t/f%5:on -1 254;;;;:on %4-117 /+21 / /+21    ; u = uncle's money:%7= $C                         ;tax rate in tenths of percent:on %7   / /+3                  ;! multiplcation loop:fa %d%c %d = %d+%c             ;!:%7 = %7-1                      ;!:on -1 /-4                      ;!;e/s//%d</           ;! move decimal point after multiplyb1/s/,//            ;!b0/s/.;             ;!:mc $2-3            ;!s//./               ;!:mc $2+2            ;!s//</               ;!d1/b1               ;!:%a = !             ;!b0/d1               ;!t/f%5:%A = "%a":fa %c%a %c=%c+%a:on -1 254;;;:on %4-101 /+4 / /+4   ; e field - stripped of spaces:on -1 81;;;:on %4-100 /+12 / /+12            ; d Install date:pr "#0/#6/Hit RETURN or enter new date":mc %1:cm:in %A             ;Enter number:sl %A %2          ;If number is 0 length, i.e. CR get next:on %2 / / /+1    ;otherwise accept number input:%A = "%C":on -1 254;;;;:on %4-104 42 / 42    ; h field - exit to edit mode:pr "#0/#6/#3/#6/   *** Enter text and type Control A when completed ***":pr "#13/#6/#13/#6/b0/s/[:cmd1:pr "#6/":ee 170;;;;DISPLAY HANDLER:%6 = %Ht/f%6-1:%A=!<;se %A:pr "#0/#6/%A#13/#6/":in "hit key to continue":pr "#0/#3/#6/"t/f%5:mc %1:%8=0:on -1 264;;;;:pr "#1/#13/The data file is too long for memory"h0/t/d1000/rd/wd:ee;;####$b1/d1/t/f1:on ?-64 / /+5 /:pr "#1/#13/You have to have a clear memory to run the forms#13/:pr "handler.  Clear it and start over."s/@d1000:eet/d2;:in "#1/Do you want to Save the configured Form Handler (Y/N)" %A:%B = "y":on %A%B /+2 / /+2wo/$A.WPM/w/wd:pr "#1/"AL;