EXT Uauxsz
EXT Uauxin
EXT Uauxrd
EXT Uauxwt
EXT Uauxfl
EXT Ustatus
Uxsize::
DW 0,0,0,0,0,0,0,0,0,0
Uxaddr::
DW 0,0,0,0,0,0,0,0,0,0
Uxnext::
DW 0,0,0,0,0,0,0,0,0,0
Uxend::
DW 0,0,0,0,0,0,0,0,0,0
Uxeof::
DW 0,0,0,0,0,0,0,0,0,0
CC1:
auxbuf::
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL Umode
POP B
CALL CCLNEG##
MOV A,H
ORA L
JNZ CC4
POP B
POP H
PUSH H
PUSH B
CALL CCLNEG##
MOV A,H
ORA L
JNZ CC4
LXI H,0
PUSH H
CALL avail
POP B
XCHG;;
POP B
POP H
PUSH H
PUSH B
CALL CCULT##
MOV A,H
ORA L
JNZ CC4
LXI H,Uxsize
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
MOV A,H
ORA L
JNZ CC4
LXI H,0
JMP CC5
CC4:
LXI H,1
CC5:
MOV A,H
ORA L
JZ CC3
LXI H,-2
RET
CC3:
LXI H,Uxaddr
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL malloc
POP B
POP D
CALL CCPINT##
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL Uxinit
POP B
LXI H,Uxinit
SHLD Uauxin
LXI H,Uxread
SHLD Uauxrd
LXI H,Uxwrite
SHLD Uauxwt
LXI H,Uxsize
SHLD Uauxsz
LXI H,Uxflush
SHLD Uauxfl
LXI H,Uxsize
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
XCHG;;
POP B
POP H
PUSH H
PUSH B
CALL CCPINT##
LXI H,0
RET
Uxinit::
LXI H,Uxnext
XCHG;;
POP B
POP H
PUSH H
PUSH B
DAD H
DAD D
PUSH H
LXI H,Uxend
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCPINT##
POP D
CALL CCPINT##
LXI H,Uxeof
XCHG;;
POP B
POP H
PUSH H
PUSH B
DAD H
DAD D
XCHG;;
LXI H,0
CALL CCPINT##
RET
Uxread::
PUSH B
CC8:
LXI H,0
DAD SP
PUSH H
LXI H,Uxnext
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCPINT##
POP H
PUSH H
PUSH H
LXI H,Uxend
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCULT##
MOV A,H
ORA L
JZ CC10
LXI H,Uxnext
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
CALL CCGINT##
INX H
POP D
CALL CCPINT##
POP H
PUSH H
CALL CCGCHAR##
POP B
RET
CC10:
LXI H,Uxeof
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
MOV A,H
ORA L
JZ CC11
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL Useteof
POP B
LXI H,-1
POP B
RET
CC11:
LXI H,0
SHLD Uauxsz
LXI H,Uxend
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
PUSH H
LXI H,8
DAD SP
CALL CCGINT##
PUSH H
LXI H,Uxnext
XCHG;;
LXI H,10
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,12
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCPINT##
PUSH H
LXI H,Uxsize
XCHG;;
LXI H,12
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
PUSH H
CALL read
POP B
POP B
POP B
POP D
DAD D
POP D
CALL CCPINT##
LXI H,Uxsize
SHLD Uauxsz
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL feof
POP B
MOV A,H
ORA L
JZ CC12
LXI H,Uxeof
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
XCHG;;
LXI H,1
CALL CCPINT##
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL Uclreof
POP B
CC12:
JMP CC8
CC9:
POP B
RET
Uxwrite::
PUSH B
CC14:
LXI H,0
DAD SP
PUSH H
LXI H,Uxnext
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCPINT##
POP H
PUSH H
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,6
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
PUSH H
LXI H,Uxsize
XCHG;;
LXI H,08
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
DAD D
POP D
CALL CCULT##
MOV A,H
ORA L
JZ CC16
POP D
PUSH D
LXI H,6
DAD SP
CALL CCGINT##
MOV A,L
STAX D
LXI H,Uxnext
XCHG;;
LXI H,4
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
CALL CCGINT##
INX H
POP D
CALL CCPINT##
LXI H,6
DAD SP
CALL CCGINT##
POP B
RET
CC16:
LXI H,4
DAD SP
CALL CCGINT##
PUSH H
CALL Uxflush
POP B
MOV A,H
ORA L
JZ CC17
LXI H,-1
POP B
RET
CC17:
JMP CC14
CC15:
POP B
RET
Uxflush::
PUSH B
PUSH B
LXI H,2
DAD SP
PUSH H
LXI H,Uxnext
XCHG;;
LXI H,08
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,10
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCSUB##
POP D
CALL CCPINT##
LXI H,0
SHLD Uauxsz
LXI H,0
DAD SP
PUSH H
LXI H,8
DAD SP
CALL CCGINT##
PUSH H
LXI H,Uxnext
XCHG;;
LXI H,10
DAD SP
CALL CCGINT##
DAD H
DAD D
PUSH H
LXI H,Uxaddr
XCHG;;
LXI H,12
DAD SP
CALL CCGINT##
DAD H
DAD D
CALL CCGINT##
POP D
CALL CCPINT##
PUSH H
LXI H,8
DAD SP
CALL CCGINT##
PUSH H
CALL write
POP B
POP B
POP B
POP D
CALL CCPINT##
LXI H,Uxsize
SHLD Uauxsz
POP B
POP D
PUSH D
PUSH B
POP H
PUSH H
CALL CCNE##
MOV A,H
ORA L
JZ CC19
LXI H,-1
POP B
POP B
RET
CC19:
LXI H,0
POP B
POP B
RET
EXT avail
EXT read
EXT Uclreof
EXT Useteof
EXT malloc
EXT feof
EXT write
EXT Umode
END
