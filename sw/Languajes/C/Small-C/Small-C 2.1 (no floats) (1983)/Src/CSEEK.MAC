EXT Ufcbptr
EXT Uchrpos
EXT Unextc
CC1:
cseek::
PUSH B
PUSH B
LXI H,10
CALL CCDSGI##
PUSH H
CALL Umode
POP B
CALL CCLNEG##
MOV A,H
ORA L
JNZ CC4
LXI H,10
CALL CCDSGI##
PUSH H
CALL isatty
POP B
MOV A,H
ORA L
JNZ CC4
LXI H,10
CALL CCDSGI##
PUSH H
CALL fflush
POP B
MOV A,H
ORA L
JNZ CC4
LXI H,0
JMP CC5
CC4:
LXI H,1
CC5:
MOV A,H
ORA L
JZ CC3
LXI H,-1
POP B
POP B
RET
CC3:
LXI H,0
DAD SP
PUSH H
LXI H,Ufcbptr
XCHG;;
LXI H,12
CALL CCDSGI##
DAD H
CALL CCDDGI##
LXI D,33
CALL CDPDPI##
LXI H,2
DAD SP
XCHG;;
POP H
PUSH H
CALL CCGINT##
CALL CCPINT##
LXI H,6
CALL CCDSGI##
JMP CC8
CC9:
LXI H,35
PUSH H
LXI H,Ufcbptr
XCHG;;
LXI H,12
CALL CCDSGI##
DAD H
CALL CCDDGI##
PUSH H
CALL Ubdos
POP B
POP B
CC10:
POP H
PUSH H
PUSH H
CALL CCGINT##
XCHG;;
LXI H,10
CALL CCDSGI##
CALL CDPDPI##
JMP CC7
CC11:
POP D
PUSH D
LXI H,08
CALL CCDSGI##
CALL CCPINT##
JMP CC7
CC12:
LXI H,-1
POP B
POP B
RET
JMP CC7
CC8:
CALL CCSWITCH##
DW CC9,2
DW CC10,1
DW CC11,0
DW 0
JMP CC12
CC7:
LXI H,10
CALL CCDSGI##
PUSH H
LXI H,33
PUSH H
CALL Usector
POP B
POP B
MOV A,H
ORA L
JZ CC13
POP D
PUSH D
POP B
POP H
PUSH H
PUSH B
CALL CCPINT##
LXI H,-1
POP B
POP B
RET
CC13:
LXI H,Uchrpos
XCHG;;
LXI H,10
CALL CCDSGI##
DAD H
DAD D
XCHG;;
LXI H,0
CALL CCPINT##
LXI H,Unextc
XCHG;;
LXI H,10
CALL CCDSGI##
DAD H
DAD D
XCHG;;
LXI H,-1
CALL CCPINT##
LXI H,10
CALL CCDSGI##
PUSH H
CALL Uclreof
POP B
LXI H,0
POP B
POP B
RET
EXT isatty
EXT Uclreof
EXT Ubdos
EXT Usector
EXT Umode
EXT fflush
END
