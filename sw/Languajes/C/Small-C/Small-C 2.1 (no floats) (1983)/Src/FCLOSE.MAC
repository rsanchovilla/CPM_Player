EXT Ufcbptr
EXT Ustatus
EXT Udevice
CC1:
fclose::
POP B
POP H
PUSH H
PUSH B
PUSH H
CALL Umode
POP B
CALL CCLNEG##
MOV A,H
ORA L
JZ CC3
LXI H,-2
RET
CC3:
POP B
POP H
PUSH H
PUSH B
PUSH H
CALL isatty
POP B
CALL CCLNEG##
MOV A,H
ORA L
JZ CC4
POP B
POP H
PUSH H
PUSH B
PUSH H
CALL fflush
POP B
MOV A,H
ORA L
JNZ CC6
LXI H,16
PUSH H
LXI H,Ufcbptr
XCHG;;
LXI H,4
CALL CCDSGI##
DAD H
CALL CCDDGI##
PUSH H
CALL Ubdos
POP B
POP B
XCHG;;
LXI H,255
CALL CCEQ##
MOV A,H
ORA L
JNZ CC6
LXI H,0
JMP CC7
CC6:
LXI H,1
CC7:
MOV A,H
ORA L
JZ CC5
LXI H,-2
RET
CC5:
CC4:
LXI H,Ustatus
XCHG;;
POP B
POP H
PUSH H
PUSH B
DAD H
DAD D
PUSH H
LXI H,Udevice
XCHG;;
LXI H,4
CALL CCDSGI##
DAD H
DAD D
XCHG;;
LXI H,0
CALL CCPINT##
CALL CCPDPI##
RET
EXT isatty
EXT Ubdos
EXT Umode
EXT fflush
END
