
(*	PROGRAM TO TEST FILEIO.SRC INCLUDE FILE		*)

PROGRAM LISTIT;

CONST
  BUFSIZE = 8191;
  RECSIZE = 79;

TYPE
  BUFFER = ARRAY [0..BUFSIZE] OF CHAR;
  REC    = ARRAY [0..RECSIZE] OF CHAR;


VAR
  TITLE : ARRAY [0..11] OF CHAR;
  INFILE : TEXT;
  INBUF : BUFFER;
  INREC : REC;
  EOF : BOOLEAN;
  INDEX : INTEGER;
  LINENUM : INTEGER;
  P : INTEGER;
  RESULT : INTEGER;

(*$I FILEIO*)		(* INCLUDE LIBRARY *)

BEGIN (* MAIN PROGRAM *)
  
  P := $5C;
  MOVE(P^,TITLE,12);	(* GET FILE NAME FROM DEFAULT FCB *)

  OPEN(INFILE,TITLE,RESULT);
  IF RESULT = 255 THEN
    BEGIN
      WRITELN('UNABLE TO OPEN INPUT FILE');
      EXIT
    END;

  INDEX := BUFSIZE + 1;	(* FORCE INITIAL READ *)

  LINENUM := 1;
  GNR(INFILE,INBUF,INDEX,INREC,EOF);
  WHILE NOT EOF DO
    BEGIN
      WRITE(LINENUM,':',CHR(9) (* TAB *));
      P := 0;
      REPEAT
        WRITE(INREC[P]);
        P := P + 1
      UNTIL INREC[P-1] = CHR($0D);
      GNR(INFILE,INBUF,INDEX,INREC,EOF);
      LINENUM := LINENUM + 1
    END;

  WRITELN('END OF INPUT FILE REACHED')

END.
