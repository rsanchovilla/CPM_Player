10 REM BUTTERFLY-HART SORT ROUTINE
20 REM COURTESY F.R. RUCKDESCHEL
30 RESET
35 CLEAR 0
40 CLEAR 200
50 ON ERROR GOTO 1560
60 AA=(FRE(0)-1000)/5
70 DIM A(AA)
80 S=1
90 INPUT "NAME OF SOURCE FILE (NO EXTENSION OR DRIVE LETTER)";FL$
100 INPUT "WHICH DRIVE IS THE DATA ON ";DR$
110 FL$=DR$+":"+FL$
120 F1$=FL$+".DAT"
130 F2$=FL$+".CON"
140 OPEN "I",1,F2$
150 INPUT#1,N
160 INPUT#1,N1
170 AA=N:AB=N1
180 FOR T=1 TO N
190 LINE INPUT#1,A$
200 NEXT T
210 PRINT "NUMERIC FIELDS:"
220 FOR T=1 TO N1
230 LINE INPUT#1,A$
240 PRINT T;")";A$
250 NEXT T
260 PRINT : PRINT "SORT BY WHICH FIELD (SELECT NUMBER FROM ABOVE)";:INPUT C
270 CLOSE 1
280 INPUT "NAME OF OUTPUT FILE (NO EXTENSION OR DRIVE LETTER)";FO$
290 OPEN "I",1,F1$
300 FOR T=1 TO N
310 LINE INPUT#1,A$
320 NEXT T
330 FOR T=1 TO N1
340 INPUT#1,A
350 IF T=C  THEN P=A
360 NEXT T
370 A(S)=P
380 IF EOF(1)<>-1 THEN S=S+1: GOTO 300
390 CLOSE 1
400 DIM B(S),P(S+LOG(S)/LOG(2)+2)
410 N=S
420  FOR I=1 TO N
430  P(I)=I
440  NEXT I
450  M=0
460  J=N+1
470  K0=0
480  K3=1
490  K4=0
500  K5=N
510  K6=0
520  K8=0
530  P(1)=1
540  P(J)=1
550  REM PUT A(I) INTO B(I)
560  FOR I=1 TO N
570  B(I)=A(I)
580  NEXT I
590  IF K5<4 THEN GOTO 660
600  K3=2*K3
610  I=0
620  L2=K5/2
630  K5=INT(L2)
640  K4=K4+(L2-K5)*K3
650  GOTO 590
660  K4=K3-K4
670  L2=K3/2
680  REM CHECK IF SORT COMPLETE
690  IF K6=K3 THEN GOTO 1290
700  K6=K6+1
710  K7=K6
720  L1=L2
730  K9=K8
740  K7=K7/2
750  IF INT(K7)<K7 THEN GOTO 800
760  K0=K0+1
770  K8=K8-L1
780  L1=L1/2
790  GOTO 740
800  K8=K8+L1
810  IF K5=2 THEN GOTO 850
820  IF K9<K4 THEN GOTO 860
830  K0=-K0
840  GOTO 920
850  IF K9<K4 THEN GOTO 910
860  K0=K0+1
870  I=I+1
880  P(I)=I
890  P(J)=I
900  J=J+1
910  K0=K0+1
920  I=I+1
930  K1=I
940  P(I)=I
950  P(J)=I
960  K=J
970  J=J+1
980  I=I+1
990  K2=I
1000  P(I)=I
1010  P(J)=I
1020  GOTO 1070
1030  J=J-1
1040  K=J-1
1050  K1=P(K)
1060  K2=P(J)
1070  M=M+1
1080  IF A(K1)<=A(K2) THEN GOTO 1160
1090  P(K)=K2
1100  K=K2
1110  K2=P(K)
1120  IF K2=K THEN GOTO 1220
1130  M=M+1
1140  IF A(K1)>A(K2) THEN GOTO 1100
1150  P(K)=K1
1160  M=M+1
1170  K=K1
1180  K1=P(K)
1190  IF K1<>K THEN GOTO 1080
1200  P(K)=K2
1210  GOTO 1230
1220  P(K)=K1
1230  K0=K0-1
1240  IF K0>0 THEN GOTO 1030
1250  IF K0=0 THEN GOTO 690
1260  K0=1-K0
1270  GOTO 920
1280  REM COLLECT RESULTS
1290  K=N+1
1300 REM
1310 REM
1320 REM
1330 REM
1340  REM P(I) IS NOT YET IN FINAL FORM. UNRAVEL.
1350  K=N+1
1360  FOR I=1 TO N
1370  K=P(K)
1380  B(I)=K
1390  NEXT I
1400  FOR I=1 TO N
1410  P(I)=B(I)
1420  NEXT I
1430 F$=DR$+":"+"TEMPDATA"
1440 OPEN "O",1,F$
1450 PRINT#1,FL$
1460 PRINT#1,DR$
1470 PRINT#1,AA
1480 PRINT#1,AB
1490 PRINT#1,N
1500 PRINT#1,FO$
1510 FOR HH=1 TO N
1520 PRINT#1,P(HH)
1530 NEXT HH
1540 CLOSE 1
1550 RUN "STEP2"
1560 PRINT "ERROR OCCURRED:"
1570 IF ERR=53 THEN PRINT "FILE NOT FOUND":GOTO 1590
1580 PRINT"UNKNOWN CAUSE. ERROR CODE =";ERR;" CHECK YOUR BASIC MANUAL."
1590 INPUT "PRESS RETURN TO RETURN TO MAIN PROGRAM (PROGRAM DISK MUST BE IN DRIVE)";A$
1600 RUN "DYNABASE"
R BASIC MANUAL."
1590 INPUT "PRESS RETURN TO RE